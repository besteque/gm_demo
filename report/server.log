
root@iZbp18l1h2hdbkxke91d6pZ:/home/xuyang/workspace/gm_demo# make clean;make   
/home/xuyang/workspace/gm_demo/code/security/src/crypt.c: In function ‘encrypt_data’:
/home/xuyang/workspace/gm_demo/code/security/src/crypt.c:500:5: warning: implicit declaration of function ‘get_devinfo_by_devid’ [-Wimplicit-function-declaration]
     get_devinfo_by_devid(devid, &devinfo);
     ^
/home/xuyang/workspace/gm_demo/code/manager/src/mgt.c: In function ‘parse_data’:
/home/xuyang/workspace/gm_demo/code/manager/src/mgt.c:397:5: warning: implicit declaration of function ‘calc_total_len’ [-Wimplicit-function-declaration]
     calc_total_len(task_val, head.data_len);
     ^
In file included from /home/xuyang/workspace/gm_demo/code/security/include/crypt.h:18:0,
                 from /home/xuyang/workspace/gm_demo/code/manager/src/mgt.c:8:
/home/xuyang/workspace/gm_demo/code/manager/src/mgt.c:399:26: warning: implicit declaration of function ‘get_total_len’ [-Wimplicit-function-declaration]
                          get_total_len(task_val), head.total_length);
                          ^
/home/xuyang/workspace/gm_demo/code/common/include/common.h:148:45: note: in definition of macro ‘log_info’
             print_sys_msg(#module, (fmt), ##__VA_ARGS__);\
                                             ^
gcc -g -O2 -Wno-unused-result  -o target/secureGW target//home/xuyang/workspace/gm_demo/code/main.o target//home/xuyang/workspace/gm_demo/code/common/src/common.o target//home/xuyang/workspace/gm_demo/code/ipc/src/server.o target//home/xuyang/workspace/gm_demo/code/security/src/crypt.o target//home/xuyang/workspace/gm_demo/code/security/src/cJSON.o target//home/xuyang/workspace/gm_demo/code/manager/src/mgt.o -L/home/xuyang/workspace/gm_demo/libs -lc -lm -lgmapi -lgmurl -lpthread
DONE!
root@iZbp18l1h2hdbkxke91d6pZ:/home/xuyang/workspace/gm_demo# 
root@iZbp18l1h2hdbkxke91d6pZ:/home/xuyang/workspace/gm_demo# 
root@iZbp18l1h2hdbkxke91d6pZ:/home/xuyang/workspace/gm_demo# 
root@iZbp18l1h2hdbkxke91d6pZ:/home/xuyang/workspace/gm_demo# ./target/secureGW 
[2018.3.30 14:17:58.112][INIT]USAGE: ./target/secureGW [port]
[2018.3.30 14:17:58.112][INIT]listen port not input, use 5069 as default.
[2018.3.30 14:17:58.112][INIT]init sw shield begin...
[2018.3.30 14:17:58.112][CRYPT]IW_OpenDevice ret:17003. maybe usr not exist(code:17003)
[2018.3.30 14:17:58.112][CRYPT]IW_InitDevice OK
[2018.3.30 14:17:58.112][CRYPT]generate temporary key-pair begin
[2018.3.30 14:17:58.114][CRYPT]generate temporary key-pair OK
[2018.3.30 14:17:58.114][CRYPT]"secureGW_server001"'s pk is AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUsIwrYSNu9jZTcrmxfA4F7wkrHblCnuveDQaR5TXAxsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPgBjIvRH958YqWHf9hewQPN+pfSgQm/VyfYDjzhOTt
[2018.3.30 14:17:58.114][CRYPT]get secret key from sk-center
[2018.3.30 14:17:59.304][CRYPT]apply secret key OK, value:AQAAAAEEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACacBBQv8Ib1A0MPazK125k1cWdNEtwM6QN5if1+cJyKAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADFrD9L1hlrkQgHS0Av0v48SexsTo1IqOOoWbt2ZwX1XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACTwYoB9LpFUpy5GxYn3Y4t2roTrXnDHC9rlqj0SqZcVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvmoLPE7geP944awDxmSxrnLArOT6Tyyv51ic/0OMmuoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsCAqWmO5BHxcRa6PYkuAYGPhgbwl+R3dK2PblfNk7m2QDY4PLlJDGBVMM1wuxU84JWYxQZrJ2ngIMwYXbyBmsQAAAAFrDGWN3lSlgA5yUYQG0q/QA=
[2018.3.30 14:17:59.306][CRYPT]import secret key to sw-shield OK.
[2018.3.30 14:17:59.306][CRYPT]get secret key from sk-center OK
[2018.3.30 14:17:59.306][INIT]init sw shield OK
[2018.3.30 14:17:59.306][INIT]gene_key_matrix begin
[2018.3.30 14:17:59.306][INIT]gene_key_matrix OK
[2018.3.30 14:17:59.306][INIT]start monitor, svr_fd:3
[2018.3.30 14:18:10.2][SVR]client 49.90.171.206(0xceab5a31) been connected.
[2018.3.30 14:18:10.2][SVR]check_cilent_exist proc_priv->client_num 0
[2018.3.30 14:18:10.2][SVR]create_monitor_task pthread_create <taskid:139841356707584> ret:0
[2018.3.30 14:18:10.2][SVR]create_monitor_task priv->client_num:0
[2018.3.30 14:18:10.2][SVR]create_monitor_task *taskid:139841356707584
[2018.3.30 14:18:10.3][SVR][child]task_data->cli_sockfd:4
---------------------serial_msg:1---------------
[2018.3.30 14:18:10.10][SVR]recv data len:312
[2018.3.30 14:18:10.10][MGT]parse_data rcv msgid 0x1
[2018.3.30 14:18:10.10][DBG]msg head(size:56) as follow:
[2018.3.30 14:18:10.10][DBG]----------------------------------
[2018.3.30 14:18:10.10][DBG]     magic        :@YGET@
[2018.3.30 14:18:10.10][DBG]     type         :1
[2018.3.30 14:18:10.10][DBG]     date_len     :9
[2018.3.30 14:18:10.10][DBG]     version      :0
[2018.3.30 14:18:10.10][DBG]     trans_id     :0
[2018.3.30 14:18:10.10][DBG]     total_length :9
[2018.3.30 14:18:10.10][DBG]     total_package:1
[2018.3.30 14:18:10.10][DBG]     index        :0
[2018.3.30 14:18:10.10][DBG]----------------------------------

[2018.3.30 14:18:10.10][MGT]-----------------> step 1 begin...
[2018.3.30 14:18:10.10][MGT]rcv msgid:0x1, devid:id2000912
[2018.3.30 14:18:10.10][MGT]devlist empty, create it
[2018.3.30 14:18:10.10][MGT]add node OK
[2018.3.30 14:18:10.10][DBG]devinfo(size:3480) as follow:
[2018.3.30 14:18:10.10][DBG]-----------------------------------
[2018.3.30 14:18:10.10][DBG]     id        :id2000912
[2018.3.30 14:18:10.10][DBG]     dev_type  :0
[2018.3.30 14:18:10.10][DBG]-----------------------------------

[2018.3.30 14:18:10.10][MGT]receive data total len:9, expect:9
[2018.3.30 14:18:10.10][MGT]-----------------> step 1 end.

[2018.3.30 14:18:10.10][SVR]prepare_interactive_data ret:0
[2018.3.30 14:18:10.10][SVR]send_to_client OK
---------------------serial_msg:2---------------
[2018.3.30 14:18:10.61][SVR]recv data len:1080
[2018.3.30 14:18:10.61][MGT]parse_data rcv msgid 0x2
[2018.3.30 14:18:10.61][DBG]msg head(size:56) as follow:
[2018.3.30 14:18:10.61][DBG]----------------------------------
[2018.3.30 14:18:10.61][DBG]     magic        :@YGET@
[2018.3.30 14:18:10.61][DBG]     type         :2
[2018.3.30 14:18:10.61][DBG]     date_len     :172
[2018.3.30 14:18:10.61][DBG]     version      :0
[2018.3.30 14:18:10.61][DBG]     trans_id     :0
[2018.3.30 14:18:10.61][DBG]     total_length :172
[2018.3.30 14:18:10.61][DBG]     total_package:1
[2018.3.30 14:18:10.61][DBG]     index        :0
[2018.3.30 14:18:10.61][DBG]----------------------------------

[2018.3.30 14:18:10.61][MGT]-----------------> step 2 begin...
[2018.3.30 14:18:10.61][MGT]client id2000912 sign data:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACI7b68ePXZrxZftQRfPHUtezmL3PO946Qh6UqlOjlWyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcU9WmG5R/pSqkogMLeIKOMCzML1YncrVkSdvFz5vB6k=
[2018.3.30 14:18:10.61][MGT]task_val->devid:id2000912
[2018.3.30 14:18:10.63][MGT]IW_VerifyData ret:0
[2018.3.30 14:18:10.63][MGT]receive data total len:172, expect:172
[2018.3.30 14:18:10.63][MGT]handle_sign_ack devid:id2000912
[2018.3.30 14:18:10.63][DBG]     id        :id2000912
[2018.3.30 14:18:10.63][DBG]     dev_type  :0
[2018.3.30 14:18:10.63][MGT][handle_sign_ack]ack to clent:
[2018.3.30 14:18:10.63][MGT][handle_sign_ack]original data:YGET SECURITY SERVER
[2018.3.30 14:18:10.65][MGT][handle_sign_ack]sign_val data:AAAAAHe0pyy8rHKRaENiOqRrXRSOhV/amPc0WIJbDNID4E4z7j4IoUysoEVXAtjp6EbTR+DbL4zvrb89Ossbc6Gf484GEomMzG9Niu7+/Meh8ZUbLTWtk/lA+03UKvsus/5fAQ==
[2018.3.30 14:18:10.65][MGT]IW_SignData ret:0
[2018.3.30 14:18:10.65][MGT][handle_sign_ack]sign_final data:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB3tKcsvKxykWhDYjqka10UjoVf2pj3NFiCWwzSA+BOMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAe/9CJNPlO3/1RvoqzI/d2Kp6riID4HM3s5iwvUVkRuo=
[2018.3.30 14:18:10.65][MGT]IW_ServerSignData ret:0
[2018.3.30 14:18:10.65][MGT]-----------------> step 2 end.

[2018.3.30 14:18:10.65][SVR]prepare_interactive_data ret:0
[2018.3.30 14:18:10.65][SVR]send_to_client OK
---------------------serial_msg:3---------------
[2018.3.30 14:18:10.158][SVR]recv data len:1340
[2018.3.30 14:18:10.158][MGT]parse_data rcv msgid 0x3
[2018.3.30 14:18:10.158][DBG]msg head(size:56) as follow:
[2018.3.30 14:18:10.158][DBG]----------------------------------
[2018.3.30 14:18:10.158][DBG]    magic        :@YGET@
[2018.3.30 14:18:10.158][DBG]    type         :3
[2018.3.30 14:18:10.158][DBG]    date_len     :244
[2018.3.30 14:18:10.158][DBG]    version      :0
[2018.3.30 14:18:10.158][DBG]    trans_id     :0
[2018.3.30 14:18:10.158][DBG]    total_length :244
[2018.3.30 14:18:10.158][DBG]    total_package:1
[2018.3.30 14:18:10.158][DBG]    index        :0
[2018.3.30 14:18:10.158][DBG]----------------------------------

[2018.3.30 14:18:10.158][MGT]-----------------> step 3 begin...
[2018.3.30 14:18:10.160][MGT]IW_SM2_OpenEnv ret:0
[2018.3.30 14:18:10.160][MGT]negotiate_crypt_type crypt_data.key:
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 6D 6D 45 4B 41
52 57 49 31 6D 64 78 37 79 59 6C 45 39 6E 77 4D
59 4C 6B 51 58 4D 72 62 36 55 4D 43 56 4B 37 74
45 34 46 4B 4D 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
71 31 55 58 57 45 63 6F 42 44 63 77 43 33 49 72
72 74 54 74 6D 47 30 4D 32 4B 30 68 45 76 70 65
79 48 38 4B 55 39 67 30 4F 48 31 47 64 4A 51 53
4B 6D 70 76 4C 49 48 58 75 73 44 4C 61 6B 54 47
68 31 56 77 46 6D 70 6D 39 4F 69 77 68 4D 77 4A
62 57 54 48 39 52 41 41 41 41 44 58 47 75 79 71
35 38 33 67 63 61 4F 2F 52 77 6C 43 73 43 58 6F
41 41 3D 3D 
[2018.3.30 14:18:10.160][MGT]after decryption, key:
A2 70 D8 A3 14 C1 DD C6 32 15 9F A7 15 79 EB FA
[2018.3.30 14:18:10.160][MGT]dev id2000912 affirmed crypt type:ALG_TYPE_SM4(7)
[2018.3.30 14:18:10.160][MGT]receive data total len:244, expect:244
[2018.3.30 14:18:10.160][MGT]affirm_crypt_type:strlen(crypt_type.key):16, content as follow:
A2 70 D8 A3 14 C1 DD C6 32 15 9F A7 15 79 EB FA
[2018.3.30 14:18:10.164][MGT]IW_SM2_MakeEnv ret:0
[2018.3.30 14:18:10.164][MGT]affirm_crypt_type evn:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2Fldq7xTPYiHxKgYlCbRdL4UyhKneTRCed40YrT67lwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdvqKnwpIPxbQp8GVm+CyV2LLfqfUIjhgoy4ktNjxsEMgjz03T/Ip8SCtTA3Au0qUI7HQ4vc79Kz2lYWAzhGOdhAAAAAWXFq7s2TerjsI7sE7RgTRAA==
[2018.3.30 14:18:10.164][MGT]-----------------> step 3 end.

[2018.3.30 14:18:10.164][SVR]prepare_interactive_data ret:0
[2018.3.30 14:18:10.164][SVR]send_to_client OK
---------------------serial_msg:4---------------
[2018.3.30 14:18:13.120][SVR]recv data len:72
[2018.3.30 14:18:13.120][MGT]parse_data rcv msgid 0x4
[2018.3.30 14:18:13.120][DBG]msg head(size:56) as follow:
[2018.3.30 14:18:13.120][DBG]----------------------------------
[2018.3.30 14:18:13.120][DBG]    magic        :@YGET@
[2018.3.30 14:18:13.120][DBG]    type         :4
[2018.3.30 14:18:13.120][DBG]    date_len     :16
[2018.3.30 14:18:13.120][DBG]    version      :0
[2018.3.30 14:18:13.120][DBG]    trans_id     :0
[2018.3.30 14:18:13.120][DBG]    total_length :16
[2018.3.30 14:18:13.120][DBG]    total_package:1
[2018.3.30 14:18:13.120][DBG]    index        :0
[2018.3.30 14:18:13.120][DBG]----------------------------------

[2018.3.30 14:18:13.120][MGT]-----------------> step 4 begin...
[2018.3.30 14:18:13.120][MGT]asert len-sizeof(msg_head_t):16=head.data_len:16
[2018.3.30 14:18:13.120][MGT]strlen(data):16, len:16
[2018.3.30 14:18:13.120][CRYPT]decrypt_data algorithm:ALG_TYPE_SM4(7)
[2018.3.30 14:18:13.120][CRYPT]sm4_decrypt_data algorithm->key:
A2 70 D8 A3 14 C1 DD C6 32 15 9F A7 15 79 EB FA
[2018.3.30 14:18:13.120][CRYPT]ciph_data:
9D AA 10 40 66 AA 49 65 34 2D E3 0A E9 AF A9 81
[2018.3.30 14:18:13.120][CRYPT]decrypt_data ret:0
[2018.3.30 14:18:13.120][MGT]decrypt_usr_data as follow:
[2018.3.30 14:18:13.120][MGT]-------------------------------
[2018.3.30 14:18:13.120][MGT]howww
[2018.3.30 14:18:13.120][MGT]-------------------------------

[2018.3.30 14:18:13.120][MGT]rcv dev id2000912 usr data
[2018.3.30 14:18:13.120][DBG]msg head(size:56) as follow:
[2018.3.30 14:18:13.120][DBG]----------------------------------
[2018.3.30 14:18:13.120][DBG]    magic        :@YGET@
[2018.3.30 14:18:13.120][DBG]    type         :4
[2018.3.30 14:18:13.120][DBG]    date_len     :16
[2018.3.30 14:18:13.120][DBG]    version      :0
[2018.3.30 14:18:13.120][DBG]    trans_id     :0
[2018.3.30 14:18:13.120][DBG]    total_length :16
[2018.3.30 14:18:13.120][DBG]    total_package:1
[2018.3.30 14:18:13.120][DBG]    index        :0
[2018.3.30 14:18:13.120][DBG]----------------------------------

[2018.3.30 14:18:13.120][MGT]receive data total len:16, expect:16
[2018.3.30 14:18:13.120][CRYPT]encrypt_data algorithm:ALG_TYPE_SM4(7)
[2018.3.30 14:18:13.120][MGT]IW_SM4_ENCRYPT ret:0
[2018.3.30 14:18:13.120][MGT]sm4_encrypt_data cipher_len:48, content as follow:
2E 7E F8 1B A8 68 D8 AB CF BF 30 41 55 0E 0F 8B
B0 95 A9 FD 0D B5 43 25 7E A3 85 0A 77 B3 55 4F
FB 2B 1C DA FB 9D F2 81 81 ED 16 8A 74 7F 04 57
[2018.3.30 14:18:13.120][MGT]sm4_encrypt_data tmp_val:48
[2018.3.30 14:18:13.120][MGT]sm4_encrypt_data tmp_orig:this is test data sent from server
[2018.3.30 14:18:13.120][CRYPT]encrypt_data ret:0
[2018.3.30 14:18:13.120][SVR]prepare_interactive_data ret:0
[2018.3.30 14:18:13.120][SVR]send_to_client OK




[2018.3.30 14:19:26.362][SVR]pthread_join ret:0
[2018.3.30 14:19:26.362][SVR]task exit, id 139841356707584
[2018.3.30 14:19:29.788][SVR]client 49.90.171.206(0xceab5a31) been connected.
[2018.3.30 14:19:29.788][SVR]check_cilent_exist proc_priv->client_num 0
[2018.3.30 14:19:29.788][SVR]create_monitor_task pthread_create <taskid:139841356707584> ret:0
[2018.3.30 14:19:29.788][SVR]create_monitor_task priv->client_num:0
[2018.3.30 14:19:29.788][SVR]create_monitor_task *taskid:139841356707584
[2018.3.30 14:19:29.788][SVR][child]task_data->cli_sockfd:4
---------------------serial_msg:5---------------
[2018.3.30 14:19:29.795][SVR]recv data len:312
[2018.3.30 14:19:29.795][MGT]parse_data rcv msgid 0x1
[2018.3.30 14:19:29.795][DBG]msg head(size:56) as follow:
[2018.3.30 14:19:29.795][DBG]----------------------------------
[2018.3.30 14:19:29.795][DBG]    magic        :@YGET@
[2018.3.30 14:19:29.795][DBG]    type         :1
[2018.3.30 14:19:29.795][DBG]    date_len     :9
[2018.3.30 14:19:29.795][DBG]    version      :0
[2018.3.30 14:19:29.795][DBG]    trans_id     :0
[2018.3.30 14:19:29.795][DBG]    total_length :9
[2018.3.30 14:19:29.795][DBG]    total_package:1
[2018.3.30 14:19:29.795][DBG]    index        :0
[2018.3.30 14:19:29.795][DBG]----------------------------------

[2018.3.30 14:19:29.795][MGT]-----------------> step 1 begin...
[2018.3.30 14:19:29.795][MGT]rcv msgid:0x1, devid:id2000912
[2018.3.30 14:19:29.795][DBG]devinfo(size:3480) as follow:
[2018.3.30 14:19:29.795][DBG]-----------------------------------
[2018.3.30 14:19:29.795][DBG]    id        :id2000912
[2018.3.30 14:19:29.795][DBG]    dev_type  :0
[2018.3.30 14:19:29.795][DBG]-----------------------------------

[2018.3.30 14:19:29.795][MGT]receive data total len:9, expect:9
[2018.3.30 14:19:29.795][MGT]-----------------> step 1 end.

[2018.3.30 14:19:29.795][SVR]prepare_interactive_data ret:0
[2018.3.30 14:19:29.795][SVR]send_to_client OK
---------------------serial_msg:6---------------
[2018.3.30 14:19:29.853][SVR]recv data len:1080
[2018.3.30 14:19:29.853][MGT]parse_data rcv msgid 0x2
[2018.3.30 14:19:29.853][DBG]msg head(size:56) as follow:
[2018.3.30 14:19:29.853][DBG]----------------------------------
[2018.3.30 14:19:29.853][DBG]    magic        :@YGET@
[2018.3.30 14:19:29.853][DBG]    type         :2
[2018.3.30 14:19:29.853][DBG]    date_len     :172
[2018.3.30 14:19:29.853][DBG]    version      :0
[2018.3.30 14:19:29.853][DBG]    trans_id     :0
[2018.3.30 14:19:29.853][DBG]    total_length :172
[2018.3.30 14:19:29.853][DBG]    total_package:1
[2018.3.30 14:19:29.853][DBG]    index        :0
[2018.3.30 14:19:29.853][DBG]----------------------------------

[2018.3.30 14:19:29.853][MGT]-----------------> step 2 begin...
[2018.3.30 14:19:29.853][MGT]client id2000912 sign data:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC2ZFiMm+P83BE95fnfOP2GThUVDbx63ESCfnaw1DOprAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8fbvwTtwXgeoUNzEE9JyX5XLhkn1k7MbY16TpAZ0jCo=
[2018.3.30 14:19:29.853][MGT]task_val->devid:id2000912
[2018.3.30 14:19:29.855][MGT]IW_VerifyData ret:0
[2018.3.30 14:19:29.855][MGT]receive data total len:172, expect:172
[2018.3.30 14:19:29.855][MGT]handle_sign_ack devid:id2000912
[2018.3.30 14:19:29.855][DBG]    id        :id2000912
[2018.3.30 14:19:29.855][DBG]    dev_type  :0
[2018.3.30 14:19:29.855][MGT][handle_sign_ack]ack to clent:
[2018.3.30 14:19:29.855][MGT][handle_sign_ack]original data:YGET SECURITY SERVER
[2018.3.30 14:19:29.857][MGT][handle_sign_ack]sign_val data:AAAAAMir1WpYwm0mZjV2Mbw8Vxka5g22IzBUhhvndToD4fSfTD0VSVpYb3FC6s4jLonI0Ny5t+aNaSJkPV+EkpESj2dIV9TmwAA0KlAdD04yAZxD8KSMuWhqkqxkGfusejq+Ow==
[2018.3.30 14:19:29.857][MGT]IW_SignData ret:0
[2018.3.30 14:19:29.857][MGT][handle_sign_ack]sign_final data:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADIq9VqWMJtJmY1djG8PFcZGuYNtiMwVIYb53U6A+H0nwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwHAmnUJ5x5AeHuIX/eYz3lnXDeNQHRjBblz/Itl3qxQ=
[2018.3.30 14:19:29.857][MGT]IW_ServerSignData ret:0
[2018.3.30 14:19:29.857][MGT]-----------------> step 2 end.

[2018.3.30 14:19:29.857][SVR]prepare_interactive_data ret:0
[2018.3.30 14:19:29.857][SVR]send_to_client OK
---------------------serial_msg:7---------------
[2018.3.30 14:19:29.937][SVR]recv data len:1340
[2018.3.30 14:19:29.937][MGT]parse_data rcv msgid 0x3
[2018.3.30 14:19:29.937][DBG]msg head(size:56) as follow:
[2018.3.30 14:19:29.937][DBG]----------------------------------
[2018.3.30 14:19:29.937][DBG]    magic        :@YGET@
[2018.3.30 14:19:29.937][DBG]    type         :3
[2018.3.30 14:19:29.937][DBG]    date_len     :244
[2018.3.30 14:19:29.937][DBG]    version      :0
[2018.3.30 14:19:29.937][DBG]    trans_id     :0
[2018.3.30 14:19:29.937][DBG]    total_length :244
[2018.3.30 14:19:29.937][DBG]    total_package:1
[2018.3.30 14:19:29.937][DBG]    index        :0
[2018.3.30 14:19:29.937][DBG]----------------------------------

[2018.3.30 14:19:29.937][MGT]-----------------> step 3 begin...
[2018.3.30 14:19:29.938][MGT]IW_SM2_OpenEnv ret:0
[2018.3.30 14:19:29.938][MGT]negotiate_crypt_type crypt_data.key:
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 74 45 52 76 31
68 55 6B 6A 42 46 6B 41 38 45 2F 7A 53 42 6E 68
39 6B 43 67 64 4E 4F 66 69 50 62 4B 36 4A 71 32
2B 59 46 47 6A 77 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
42 64 43 71 5A 49 66 58 65 4F 36 6A 31 6E 53 74
6C 6F 54 63 48 50 68 4D 59 6B 4C 6A 62 72 4F 4E
62 37 6E 71 36 32 32 64 4C 32 65 77 57 71 5A 4D
41 61 41 55 41 53 65 73 74 50 62 74 68 54 47 66
6B 34 45 31 46 6A 44 49 30 7A 50 46 71 47 48 37
72 4D 32 68 4E 68 41 41 41 41 43 58 31 68 6D 4F
70 43 7A 36 4D 74 30 4A 4A 49 62 38 78 6A 6C 31
41 41 3D 3D 
[2018.3.30 14:19:29.939][MGT]after decryption, key:
A2 70 D8 A3 14 C1 DD C6 32 15 9F A7 15 79 EB FA
[2018.3.30 14:19:29.939][MGT]dev id2000912 affirmed crypt type:ALG_TYPE_SM2(5)
[2018.3.30 14:19:29.939][MGT]receive data total len:244, expect:244
[2018.3.30 14:19:29.939][MGT]affirm_crypt_type:strlen(crypt_type.key):16, content as follow:
A2 70 D8 A3 14 C1 DD C6 32 15 9F A7 15 79 EB FA
[2018.3.30 14:19:29.942][MGT]IW_SM2_MakeEnv ret:0
[2018.3.30 14:19:29.942][MGT]affirm_crypt_type evn:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABTcqG2KHgJv2ig0KwdA+ixSfOlrkm13ksRX+AHLmeq+QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2tPI1uOg04J8HZu0oON4vXKNZxZUh3Xh2/qVPnAyJzgrO7pnSg0LJ8VYQo6If9d046EDp9xkj6oasXD/AH/hgBAAAABH8wHe0ham4mVrzI3ABVFmAA==
[2018.3.30 14:19:29.942][MGT]-----------------> step 3 end.

[2018.3.30 14:19:29.942][SVR]prepare_interactive_data ret:0
[2018.3.30 14:19:29.942][SVR]send_to_client OK
---------------------serial_msg:8---------------
[2018.3.30 14:19:31.960][SVR]recv data len:288
[2018.3.30 14:19:31.960][MGT]parse_data rcv msgid 0x4
[2018.3.30 14:19:31.960][DBG]msg head(size:56) as follow:
[2018.3.30 14:19:31.960][DBG]----------------------------------
[2018.3.30 14:19:31.960][DBG]    magic        :@YGET@
[2018.3.30 14:19:31.960][DBG]    type         :4
[2018.3.30 14:19:31.960][DBG]    date_len     :232
[2018.3.30 14:19:31.960][DBG]    version      :0
[2018.3.30 14:19:31.960][DBG]    trans_id     :0
[2018.3.30 14:19:31.960][DBG]    total_length :232
[2018.3.30 14:19:31.960][DBG]    total_package:1
[2018.3.30 14:19:31.960][DBG]    index        :0
[2018.3.30 14:19:31.960][DBG]----------------------------------

[2018.3.30 14:19:31.960][MGT]-----------------> step 4 begin...
[2018.3.30 14:19:31.960][MGT]asert len-sizeof(msg_head_t):232=head.data_len:232
[2018.3.30 14:19:31.960][MGT]strlen(data):232, len:232
[2018.3.30 14:19:31.960][CRYPT]decrypt_data algorithm:ALG_TYPE_SM2(5)
[2018.3.30 14:19:31.961][CRYPT]decrypt_data ret:0
[2018.3.30 14:19:31.962][MGT]decrypt_usr_data as follow:
[2018.3.30 14:19:31.962][MGT]-------------------------------
[2018.3.30 14:19:31.962][MGT]hwosss
[2018.3.30 14:19:31.962][MGT]-------------------------------

[2018.3.30 14:19:31.962][MGT]rcv dev id2000912 usr data
[2018.3.30 14:19:31.962][DBG]msg head(size:56) as follow:
[2018.3.30 14:19:31.962][DBG]----------------------------------
[2018.3.30 14:19:31.962][DBG]    magic        :@YGET@
[2018.3.30 14:19:31.962][DBG]    type         :4
[2018.3.30 14:19:31.962][DBG]    date_len     :232
[2018.3.30 14:19:31.962][DBG]    version      :0
[2018.3.30 14:19:31.962][DBG]    trans_id     :0
[2018.3.30 14:19:31.962][DBG]    total_length :232
[2018.3.30 14:19:31.962][DBG]    total_package:1
[2018.3.30 14:19:31.962][DBG]    index        :0
[2018.3.30 14:19:31.962][DBG]----------------------------------

[2018.3.30 14:19:31.962][MGT]receive data total len:232, expect:232
[2018.3.30 14:19:31.962][CRYPT]encrypt_data algorithm:ALG_TYPE_SM2(5)
[2018.3.30 14:19:31.962][MGT]CPK_Get_IPK ret:0
[2018.3.30 14:19:31.962][MGT]devid:id2000912
[2018.3.30 14:19:31.966][MGT]IW_SM2_EncryptData ret:0
[2018.3.30 14:19:31.966][MGT]sm2_encrypt_data cipher_len:268, content as follow:
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 43 46 53 44 53 42
6A 66 38 6F 58 43 70 4F 35 7A 6B 45 6C 74 6C 2B
38 54 5A 47 45 68 36 78 69 62 78 4C 4B 64 67 75
47 38 77 34 6B 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41
33 54 69 51 79 44 31 52 55 6A 5A 4F 63 70 31 2F
32 76 37 54 30 59 42 37 6F 4E 6D 4E 56 6F 30 67
4D 74 67 34 4C 35 7A 4D 46 48 49 63 59 50 6E 58
71 42 59 55 6A 6F 70 71 5A 54 76 53 38 4D 63 72
6F 58 72 53 4D 6E 6C 48 53 6A 31 36 6D 6B 64 42
34 51 63 37 46 79 4D 41 41 41 41 55 6D 66 74 55
53 56 63 69 44 34 77 74 4D 6F 53 56 66 32 36 32
30 78 5A 36 41 74 65 51 62 36 2B 74 58 63 64 53
34 45 34 42 51 71 44 55 66 77 41 3D 
[2018.3.30 14:19:31.966][CRYPT]encrypt_data ret:0
[2018.3.30 14:19:31.966][SVR]prepare_interactive_data ret:0
[2018.3.30 14:19:31.966][SVR]send_to_client OK


^C
root@iZbp18l1h2hdbkxke91d6pZ:/home/xuyang/workspace/gm_demo# 